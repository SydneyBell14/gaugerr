test_that("conf_intervals_gpq works", {
  data1 <- data.frame(P=c(1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,
                          4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,
                          7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,
                          10,10,10,10,10,10,10,10,10),
                      Y=c(37,38,37,41,41,40,41,42,41,42,41,43,42,42,42,43,42,43,
                          30,31,31,31,31,31,29,30,28,42,43,42,43,43,43,42,42,42,
                          28,30,29,29,30,29,31,29,29,42,42,43,45,45,45,44,46,45,
                          25,26,27,28,28,30,29,27,27,40,40,40,43,42,42,43,43,41,
                          25,25,25,27,29,28,26,26,26,35,34,34,35,35,34,35,34,35),
                      O=c(1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,
                          1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,
                          1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,
                          1,1,1,2,2,2,3,3,3))
  expect_error(conf_intervals_gpq(4))
  expect_equal(conf_intervals_gpq(data1), data.frame(
    quantity = c("s2_repeat","s2_p","s2_o", "s2_po","s2_tot", "s2_repro", "s2_gauge", "pg_ratio","gt_ratio", "pr_ratio"),
    estimate = c(0.51111111, 48.29259259, 0.56460905, 0.72798354, 50.09629630, 1.29259259, 1.80370370, 26.77412731, 0.03600473, 94.48550725),
    lower = c(0.36863440, 22.56128645, 0.06887146, 0.33173020, 25.38026760, 0.66790450, 1.18564046, 1.75212823, 0.01170249, 40.25038291),
    upper = c(0.7571053, 161.5399055, 25.7213236, 1.7863736, 178.2569012, 26.5399822, 27.0847957, 84.4518732, 0.3633552, 324.2078800)
  ),
  tolerance = 1e-1)
})
