test_that("unbalanced_two_factor works", {
  data1 <- data.frame(P=c(1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,
                          4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,
                          7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,
                          10,10,10,10,10,10,10,10,10),
                      Y=c(37,38,37,41,41,40,41,42,41,42,41,43,42,42,42,43,42,43,
                          30,31,31,31,31,31,29,30,28,42,43,42,43,43,43,42,42,42,
                          28,30,29,29,30,29,31,29,29,42,42,43,45,45,45,44,46,45,
                          25,26,27,28,28,30,29,27,27,40,40,40,43,42,42,43,43,41,
                          25,25,25,27,29,28,26,26,26,35,34,34,35,35,34,35,34,35),
                      O=c(1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,
                          1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,
                          1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,1,1,1,2,2,2,3,3,3,
                          1,1,1,2,2,2,3,3,3))
  data2 <- data.frame(P=c(5,5,7,6,6,6,6,6,6,5,6,6,6,6,6,6,6,6,5,6,7,6,6,6,6,6,7,
                          7,6,7,6,7,6,6,6,2,7,6,6,6,7,7,6,7,7,6,6,6,7,3,6,7,7,6,
                          2,7,2,6,6,7,7,6,7,6,7,5,6,6,7,2,2,6,5,6,7,6,7,7,6,6,4,
                          6,7,7,7,6,7,2,7,7,2,5,7,6,6,7,7,6,6,6,7,7,7,7,2,6,5,5,
                          7,6,7,6,7,6,6,6,7,7,6,7,7,7,6,6,7,7,7,7,5,7,6,2,6,5,2,
                          6,7,2,7,7,5,2,2,5,2,7,5,2,2,5,2,5,6,7,6,2,6,7,7,2,2,7,
                          2,5,2,2,6,7,6,2,5,2,7,6,6,5,7,6,6,2,2,2,2,7,7,7,2,5,2,
                          5,5,2,5,2,7,4,4,4,4,4,4,2,2,7,2,5,2,2,5,2,7,2,7,2,5,2,
                          2,2,6,5,5,2,2,5,5,2,2,2,5,7,5,2,6,6,5,5,6,5,6,5,5,5,5,
                          5,3,3,5,5,5,3,3,5,5,1,5,6,5,5,5,5,5,5,6,3,5,5,5,5,5,5,
                          6,6,5,5,5,5,6,5,3,3,3,5,5,5,5,5,5,5,5,2,5,5,5,5,5,5,5,
                          5,5,2,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
                          5,5,2,5,5,5,5,5,5,5,5,5,5,5,5,5,2,2,5,5,5,5,5,5,5,5),
                      O=c(2,2,8,1,2,4,6,2,6,2,2,6,8,2,8,2,1,2,2,2,8,2,1,2,10,2,
                          4,4,5,2,2,5,2,2,8,6,2,2,2,8,2,2,6,2,2,2,2,2,2,7,8,2,5,
                          8,6,2,6,5,6,2,2,2,2,5,2,2,2,4,2,6,6,8,2,2,2,2,2,6,2,2,
                          9,2,2,5,6,2,4,6,8,2,6,2,2,2,8,6,5,6,5,2,4,5,8,2,6,6,2,
                          2,2,2,2,2,2,5,5,2,2,4,2,2,2,4,2,4,4,2,2,2,2,2,2,1,5,2,
                          6,4,8,6,3,2,2,6,6,2,1,2,2,6,6,2,6,2,2,2,2,6,8,2,5,6,6,
                          11,6,2,6,6,2,8,4,6,2,1,4,5,2,2,4,5,2,6,6,6,6,5,11,8,6,
                          2,1,2,2,6,2,6,2,9,9,9,9,9,7,6,6,2,6,2,6,6,2,1,2,6,4,6,
                          2,1,6,6,2,5,5,6,6,2,2,6,6,6,2,6,9,6,2,2,2,9,8,2,6,5,2,
                          5,9,2,7,7,9,2,2,7,7,9,2,2,2,10,2,2,2,2,2,5,6,7,2,2,2,2,
                          2,2,2,8,2,2,2,2,2,2,7,7,7,2,9,2,2,5,2,2,2,6,2,2,2,2,2,
                          2,2,2,2,6,2,2,2,2,2,2,2,2,2,2,2,9,2,2,2,2,2,2,2,2,2,2,
                          2,2,2,2,6,2,2,2,2,2,2,2,2,2,2,2,2,2,6,6,2,2,2,9,2,9,9,2),
                      Y=c(-0.0769,-0.0755,-0.4500,-0.2769,-0.2605,-0.2574,-0.2444,
                          -0.2275,-0.2284,-0.0446,-0.2167,-0.2196,-0.2105,-0.2014,
                          -0.1941,-0.1690,-0.1683,-0.1639,-0.0335,-0.1633,-0.2219,
                          -0.1593,-0.1608,-0.1565,-0.1595,-0.1559,-0.2105,-0.2108,
                          -0.1485,-0.1967,-0.1432,-0.1904,-0.1389,-0.1387,-0.1375,
                          -0.1551,-0.1786,-0.1311,-0.1290,-0.1286,-0.1690,-0.1690,
                          -0.1264,-0.1666,-0.1638,-0.1181,-0.1186,-0.1150,-0.1546,
                          -0.0774,-0.1131,-0.1514,-0.1493,-0.1077,-0.0278,-0.1468,
                          -0.1198,-0.1045,-0.1061,-0.1426,-0.1427,-0.1034,-0.1370,
                          -0.1009,-0.1366,-0.0200,-0.0981,-0.0976,-0.1278,-0.0360,
                          -0.0300,-0.0930,-0.0185,-0.0904,-0.1175,-0.0849,-0.1106,
                          -0.1123,-0.0795,-0.0794,-0.0560,-0.0773,-0.1008,-0.1003,
                          -0.1023,-0.0737,-0.0998,-0.0790,-0.0940,-0.0930,-0.0841,
                          -0.0137,-0.0875,-0.0638,-0.0641,-0.0853,-0.0831,-0.0597,
                          -0.0581,-0.0582,-0.0790,-0.0783,-0.0775,-0.0768,-0.0867,
                          -0.0550,-0.0108,-0.0106,-0.0709,-0.0521,-0.0698,-0.0497,
                          -0.0656,-0.0482,-0.0466,-0.0461,-0.0605,-0.0582,-0.0415,
                          -0.0559,-0.0551,-0.0552,-0.0400,-0.0400,-0.0543,-0.0537,
                          -0.0527,-0.0517,-0.0076,-0.0500,-0.0342,-0.0618,-0.0339,
                          -0.0065,-0.0364,-0.0319,-0.0429,-0.0412,-0.0363,-0.0356,
                          -0.0048,-0.0302,-0.0330,-0.0045,-0.0255,-0.0288,-0.0039,
                          -0.0237,-0.0188,-0.0037,-0.0190,-0.0031,-0.0147,-0.0192,
                          -0.0136,-0.0165,-0.0107,-0.0142,-0.0133,-0.0110,-0.0102,
                          -0.0115,-0.0123,-0.0016,-0.0109,-0.0103,-0.0067,-0.0038,
                          -0.0021,0.0012,0.0003,0.0020,0.0025,0.0021,0.0023,0.0005,
                          0.0058,0.0042,0.0054,0.0094,0.0080,0.0145,0.0129,0.0124,
                          0.0146,0.0156,0.0177,0.0025,0.0219,0.0032,0.0032,0.0150,
                          0.0035,0.0256,0.0244,0.0139,0.0139,0.0139,0.0139,0.0139,
                          0.0139,0.0286,0.0277,0.0284,0.0327,0.0044,0.0333,0.0383,
                          0.0056,0.0404,0.0419,0.0587,0.0451,0.0657,0.0080,0.0581,
                          0.0599,0.0682,0.0444,0.0092,0.0102,0.0777,0.0783,0.0120,
                          0.0124,0.1152,0.1217,0.0860,0.0139,0.0956,0.0149,0.1116,
                          0.0803,0.0803,0.0165,0.0197,0.1025,0.0206,0.1047,0.0217,
                          0.0219,0.0227,0.0227,0.0235,0.0779,0.0797,0.0240,0.0253,
                          0.0254,0.0863,0.0895,0.0264,0.0274,0.0277,0.0272,0.1367,
                          0.0279,0.0282,0.0283,0.0288,0.0290,0.0298,0.1481,0.0987,
                          0.0302,0.0310,0.0312,0.0314,0.0322,0.0337,0.1669,0.1778,
                          0.0359,0.0358,0.0369,0.0366,0.1820,0.0373,0.1281,0.1282,
                          0.1313,0.0395,0.0417,0.0434,0.0432,0.0441,0.0441,0.0448,
                          0.0452,0.0868,0.0455,0.0461,0.0473,0.0476,0.0481,0.0495,
                          0.0502,0.0503,0.0504,0.5010,0.0520,0.0523,0.0529,0.0522,
                          0.0560,0.0556,0.0569,0.0564,0.0565,0.0570,0.0603,0.0595,
                          0.0622,0.0621,0.0626,0.0631,0.0638,0.0645,0.0647,0.0670,
                          0.0684,0.0679,0.0674,0.0696,0.0694,0.0712,0.7018,0.0746,
                          0.0755,0.0793,0.0801,0.0809,0.0823,0.0876,0.0886,0.0915,
                          0.0934,0.0932,0.0954,0.0985,0.9582,0.1385,0.1100,0.1144,
                          0.1213,0.1242,0.1363,0.1519,0.1556,0.1757))

  expect_error(unbalanced_two_factor(4))
})
